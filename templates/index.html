<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Vedic Astrology</title>
  <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
<div class="container">
  <h1>Vedic Astrology — Demo</h1>
  <div class="card">
    <label>Name</label>
    <input id="name" placeholder="Your name" value="Saheel">

    <label>DOB (YYYY-MM-DD)</label>
    <input id="dob" value="1990-04-20">

    <label>UTC Birth ISO</label>
    <input id="utc" value="1990-04-20T05:25:00+00:00">

    <!-- New location fields -->
    <label>Country</label>
    <select id="country" required></select>

    <label>State</label>
    <select id="state" required></select>

    <label>City</label>
    <select id="city" required></select>

    <!-- Hidden lat/lon populated from City -->
<input type="hidden" id="latitude" />
<input type="hidden" id="longitude" />


     <label>Tone</label>
    <select id="tone">
      <option>Friendly</option>
      <option>Neutral</option>
      <option>Playful</option>
      <option>Spiritual</option>
    </select>

    <small id="coordPreview" style="opacity:0.7;"></small>
<script>
  // Show coords when city changes
  document.addEventListener('change', (e) => {
    if (e.target && e.target.id === 'city') {
      const lat = document.getElementById('latitude').value || '';
      const lon = document.getElementById('longitude').value || '';
      document.getElementById('coordPreview').textContent = lat && lon ? `lat ${lat}, lon ${lon}` : '';
    }
  });
</script>


    <button onclick="callPredict()">Get Prediction</button>
    <pre id="out" class="card" style="margin-top:10px"></pre>
  </div>
  <footer>Analytics enabled • Admin: /admin/analytics</footer>
</div>

<script src="/static/js/app.js?v=3"></script>

<!-- Dropdown logic -->
<script>
(async function(){
  const res = await fetch("/static/cities_in.json");
  const cities = await res.json();

  const byCountry = {};
  for (const c of cities) {
    byCountry[c.country] ??= {};
    byCountry[c.country][c.state] ??= [];
    byCountry[c.country][c.state].push(c);
  }

  const $country = document.getElementById("country");
  const $state = document.getElementById("state");
  const $city = document.getElementById("city");
  const $lat = document.getElementById("latitude");
  const $lon = document.getElementById("longitude");
  const $preview = document.getElementById("coordPreview");

  function fillCountries() {
    $country.innerHTML = `<option value="">Select</option>` +
      Object.keys(byCountry).map(c=>`<option>${c}</option>`).join("");
  }
  function fillStates() {
    const c = $country.value;
    $state.innerHTML = `<option value="">Select</option>`;
    $city.innerHTML = `<option value="">Select</option>`;
    if (!c) return;
    const states = Object.keys(byCountry[c]).sort();
    $state.innerHTML += states.map(s=>`<option>${s}</option>`).join("");
  }
  function fillCities() {
    const c = $country.value, s = $state.value;
    $city.innerHTML = `<option value="">Select</option>`;
    if (!c || !s) return;
    const list = byCountry[c][s].sort((a,b)=>a.city.localeCompare(b.city));
    $city.innerHTML += list.map(x=>`<option data-lat="${x.lat}" data-lon="${x.lon}">${x.city}</option>`).join("");
  }
  function setLatLon() {
    const opt = $city.options[$city.selectedIndex];
    if (!opt || !opt.dataset.lat) return;
    $lat.value = opt.dataset.lat;
    $lon.value = opt.dataset.lon;
    if ($preview) {
      $preview.textContent = `lat ${$lat.value}, lon ${$lon.value}`;
    }
  }

  $country.addEventListener("change", fillStates);
  $state.addEventListener("change", fillCities);
  $city.addEventListener("change", setLatLon);

  fillCountries();
  if ($country.querySelector('option[value="India"]')) {
    $country.value = "India";
    fillStates();
  }
})();
</script>
</body>
</html>
